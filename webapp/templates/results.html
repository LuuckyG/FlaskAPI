{% extends "layout.html" %}
{% block content %}
  <div class="search-engine-wrapper">
    <div class="text-wrapper">
      <div class="section-header"><h1>WBSO Search Engine</h1></div>
      <div class="section-content">Lorem ipsum dolor sit amet consectetur adipisicing elit. 
        Id omnis inventore maxime, tempora tempore voluptate, quas ipsa repudiandae dolorum neque harum quibusdam? 
        Maiores nemo dignissimos iusto velit, et aspernatur.</div>
    </div>

    <div class="search-input-wrapper">
      <h3 class="search-input-title search-heading">Zoektermen</h3>
      <table class="table search-input-items">
        <tr>
            <th class="search-input-key"> Titel </th>
            <td class="search-input-value"> {{ query.title }} </td>
        </tr>
        <tr>
          <th class="search-input-key"> Zwaartepunt </th>
          <td class="search-input-value"> {{ query.zwaartepunt }} </td>
      </tr>
      <tr>
        <th class="search-input-key"> Key Terms </th>
        <td class="search-input-value"> {{ query.key_terms }} </td>
      </tr>
      </table>
    </div>

    <div class="search-output-wrapper">
      <h3 class="search-output-title search-heading">Best overeenkomende documenten, gebaseerd op:</h3>

      <select name="filter" id="filter-results" onchange="filterContent();">
        <option value="full_text" selected>Hele document</option>
        <option value="aanleiding">Aanleiding</option>
        <option value="t_knel">Technische knelpunten</option>
        <option value="opl">Oplossingsrichting</option>
        <option value="prog">Programmeertalen, ontwikkelomgevingen en tools</option>
        <option value="nieuw">Technische nieuwheid</option>
      </select>

      <div class="search-ouput">
        {% for key in results.keys() %}
          {% if results[key] %}
            <div class="search-output-section" id="{{ key }}">
              <table class="table search-input-items">
                <thead classs="thead-dark">
                  <tr>
                    <th class="search-output-table" scope="col"></th>
                    <th class="search-output-table" scope="col">Bedrijf</th>
                    <th class="search-output-table" scope="col">Titel</th>
                    <th class="search-output-table" scope="col">Score</th>
                    <th class="search-output-table" scope="col">File</th>
                  </tr>
                </thead>
                {% for hit in results[key] %}
                  <tr>
                    <th class="search-output-key" scope="row"> {{ loop.index0 + 1 }} </th>
                    <td class="search-output-key"> {{ hit['bedrijf'] }} </td>
                    <td class="search-outut-value"> {{ hit['title'] }} </td>
                    <td class="search-outut-value"> {{ '%0.3f'| format(hit['score']) }} </td>
                    <td>
                      <form class="open-doc-form" id="form-{{ key }}-{{ loop.index0 }}" method="POST" 
                              action="{{ url_for('searches.open_document', filename=hit['path']) }}">
                        {% if hit['path'].split('.')[1] == 'doc' or hit['path'].split('.')[1] == 'docx'%}
                          <a class="open-doc-link" href="#" 
                            onclick="openDocument('form-{{ key }}-{{ loop.index0 }}')">
                            <i class="fa fa-file-word-o"></i>
                          </a>
                        {% else %}
                          <a class="open-doc-link" href="#" 
                            onclick="openDocument('form-{{ key }}-{{ loop.index0 }}')">
                            <i class="fa fa-file-pdf-o"></i>
                          </a>
                        {% endif %}
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </table>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    
    <div class="search-again-btn">
      <a class="btn btn-outline-info" href="{{ url_for('searches.search') }}"><span>Zoek opnieuw</span></a>
    </div>

  </div>
{% endblock content%}
